=====================
pyyaml-CVE-2020-14343
=====================
Experimenting with the PyYAML vulnerability `CVE-2020-14343`_.

`:information_source:`

  The vulnerability was fixed in PyYAML version 5.4 [BUG]_

Testing environment
===================
- **Execution platform:** macOS with `conda`_ (environment manager)
- **Python requirements:**

  - `flask`_ (v1.1.2): for building a simple server that will read a payload sent 
    as a ``yaml`` file
    
    `:star:`
     
     The version choosen for ``flask`` is not that important. Just get the
     latest or if you already had installed it, the version you have should be good
     enough for the tests. What is important is the version of ``pyyaml``
  - `pyyaml`_: multiple versions of PyYAML were tested
  
    - ``pyyaml`` 3.13 (Jul 5, 2018)
    - ``pyyaml`` 5.1 (Mar 13, 2019)
    - ``pyyaml`` 5.3 (Jan 6, 2020)
    - ``pyyaml`` 5.4 (Jan 19, 2021)

Code
====
The Python code for the server is the following:

.. code-block:: Python

   from flask import Flask, request
   import yaml
   import re
   import os

   app = Flask(__name__)
   app.secret_key = os.urandom(16)


   @app.route('/test', methods=["POST"])
   def pwnme():
       if not re.fullmatch(b"^[\n --/-\]a-}]*$", request.data, flags=re.MULTILINE):
           return "Nice try!", 400
       return yaml.load(request.data)


   if __name__ == '__main__':
       app.run(host='0.0.0.0', port=8080)

Experiments
===========
Exp 1: pyyaml 3.13
------------------
Exp 2: pyyaml 5.1
-----------------
Exp 3: pyyaml 5.3
-----------------
Exp 4: pyyaml 5.4
-----------------

References
==========
.. [BUG] “Bug 1860466 – (CVE-2020-14343) CVE-2020-14343 PyYAML: Incomplete Fix for CVE-2020-1747.” 
   *Redhat.Com*, https://bugzilla.redhat.com/show_bug.cgi?id=1860466. Accessed 30 June 2021.

.. URLs
.. _conda: https://docs.conda.io/projects/conda/en/latest/user-guide/getting-started.html
.. _CVE-2020-14343: https://access.redhat.com/security/cve/cve-2020-14343
.. _flask: https://flask.palletsprojects.com/
.. _pyyaml: https://pypi.org/project/PyYAML/
